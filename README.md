# enchant.ts

![build](https://github.com/ichisadashioko/enchant.ts/workflows/build/badge.svg)

This project aims to port the game library [enchant.js](https://github.com/wise9/enchant.js) to TypeScript.

## Development guide

Build `enchant.js` to see how `enchant.js` works.

- Build `enchant.js` with `npm run test` in the `enchant.js` repo.
- Run a static files web server at `enchant.js` root (e.g. `python3 -m http.server 8080`).
- Use Chrome and start a Guest session to disable all the extensions.

Setup development environment.

- VSCode (optional)
- Install Node.JS, Yarn, and Python (optional).
- Run `yarn` or `npm install` to install dependencies.
- Run `yarn build` or `npm build` to build TypeScript source code.
- Fix the errors from the output.

## Checklist

- [ ] `header.js`
  - [ ] `Object.defineProperty`
  - [ ] `Object.defineProperties`
  - [ ] `Object.create`
  - [ ] `Object.getPrototypeOf`
  - [ ] `Function.prototype.bind`
  - [x] `getTime`
  - [ ] `window.requestAnimationFrame`
  - [ ] `enchant`
  - [ ] `window.addEventListener('message')`
- [ ] `Class.js`
  - [ ] `Class`
  - [ ] `create`
  - [ ] `getInheritanceTree`
- [ ] `Env.js`
  - [ ] `ENV`
    - [ ] `VERSION`
    - [x] `BROWSER`
    - [x] `VENDOR_PREFIX`
    - [x] `TOUCH_ENABLED`
    - [x] `RETINA_DISPLAY`
    - [x] `USE_FLASH_SOUND`
    - [x] `USE_DEFAULT_EVENT_TAGS`
    - [x] `CANVAS_DRAWING_METHODS`
    - [x] `KEY_BIND_TABLE`
    - [x] `PREVENT_DEFAULT_KEY_CODES`
    - [x] `SOUND_ENABLED_ON_MOBILE_SAFARI`
    - [x] `USE_TOUCH_TO_START_SCENE`
    - [x] `USE_WEB_AUDIO`
    - [x] `USE_ANIMATION`
    - [x] `COLOR_DETECTION_LEVEL`
- [ ] `Event.js`
  - [ ] Some `ACTION_START`, `ACTION_TICK`, etc. events add `timeline` and `elapsed` properties.
  - [ ] `InputSource` adds `source` and `data` to `INPUT_STATE_CHANGED` event
  - [ ] `WebAudioSound` adds `message` for `ERROR` event
  - [ ] `Core` adds `elapsed` for `ENTER_FRAME` event
  - [x] `initialize`
  - [x] `_initPosition`
  - [x] `LOAD`
  - [x] `ERROR`
  - [x] `CORE_RESIZE`
  - [x] `PROGRESS`
  - [x] `ENTER_FRAME`
  - [x] `EXIT_FRAME`
  - [x] `ENTER`
  - [x] `EXIT`
  - [x] `CHILD_ADDED`
  - [x] `ADDED`
  - [x] `ADDED_TO_SCENE`
  - [x] `CHILD_REMOVE`
  - [x] `REMOVED`
  - [x] `REMOVED_FROM_SCENE`
  - [x] `TOUCH_START`
  - [x] `TOUCH_MOVE`
  - [x] `TOUCH_END`
  - [x] `RENDER`
  - [x] `INPUT_START`
  - [x] `INPUT_CHANGE`
  - [x] `INPUT_END`
  - [x] `INPUT_STATE_CHANGED`
  - [x] `LEFT_BUTTON_DOWN`
  - [x] `LEFT_BUTTON_UP`
  - [x] `RIGHT_BUTTON_DOWN`
  - [x] `RIGHT_BUTTON_UP`
  - [x] `UP_BUTTON_DOWN`
  - [x] `UP_BUTTON_UP`
  - [x] `DOWN_BUTTON_DOWN`
  - [x] `DOWN_BUTTON_UP`
  - [x] `A_BUTTON_DOWN`
  - [x] `A_BUTTON_UP`
  - [x] `B_BUTTON_DOWN`
  - [x] `B_BUTTON_UP`
  - [x] `ADDED_TO_TIMELINE`
  - [x] `REMOVED_FROM_TIMELINE`
  - [x] `ACTION_START`
  - [x] `ACTION_END`
  - [x] `ACTION_TICK`
  - [x] `ACTION_ADDED`
  - [x] `ACTION_REMOVED`
  - [x] `ANIMATION_END`
- [x] `EventTarget.js`
- [ ] `Core.js`
  - [ ] `initialize`
    - [ ] `detectAssets` from plugins
  - [x] `_dispatchCoreResizeEvent`
  - [x] `_oncoreresize`
  - [x] `preload`
  - [x] `load`
  - [x] `start`
  - [x] `_requestPreload`
  - [x] `_createTouchToStartScene`
  - [x] `debug`
  - [x] `actualFps`
  - [x] `_requestNextFrame`
  - [x] `_callTick`
  - [x] `_tick`
  - [x] `getTime`
  - [x] `stop`
  - [x] `pause`
  - [x] `resume`
  - [x] `pushScene`
  - [x] `popScene`
  - [x] `replaceScene`
  - [x] `removeScene`
  - [x] `_buttonListener`
  - [x] `keybind`
  - [x] `keyunbind`
  - [x] `changeButtonState`
  - [x] `getElapsedTime`
  - [x] `findExt`
- [x] `Game.js`
- [x] `InputManager.js`
  - [x] `initialize`
  - [x] `bind`
  - [x] `unbind`
  - [x] `addBroadcastTarget`
  - [x] `removeBroadcastTarget`
  - [x] `broadcastEvent`
  - [x] `changeState`
- [x] `InputSource.js`
  - [x] `initialize`
  - [x] `notifyStateChange`
- [x] `BinaryInputManager.js`
  - [x] `bind`
  - [x] `unbind`
  - [x] `changeState`
  - [x] `_down`
  - [x] `_up`
- [x] `BinaryInputSource.js`
  - [x] `initialize`
- [x] `KeyboardInputManager.js`
  - [x] `initialize`
  - [x] `keybind`
  - [x] `keyunbind`
  - [x] `_attachDOMEvent`
- [x] `KeyboardInputSource.js`
  - [x] `initialize`
  - [x] `_instances`
  - [x] `getByKeyCode`
- [ ] `Node.js`
  - [ ] `childNodes` property only exists on some sub-classes (`Group`, `enchant.widget.EntityGroup`, and four more classes from `gl.enchant.js` - somes are not sub-class of `Node`) but `Node` tries to access it
  - [x] `initialize`
  - [x] `moveTo`
  - [x] `moveBy`
  - [x] `x`
  - [x] `y`
  - [x] `_updateCoordinate`
  - [x] `remove`
- [ ] `Entity.js`
  - Remove collection (breaking change)
  - [ ] ~~`_intersectBetweenClassAndInstance`~~
  - [ ] ~~`_intersectBetweenClassAndClass`~~
  - [ ] ~~`_intersectStrictBetweenClassAndInstance`~~
  - [ ] ~~`_intersectStrictBetweenClassAndClass`~~
  - [ ] ~~`_staticIntersect`~~
  - [ ] ~~`_staticIntersectStrict`~~
  - [ ] ~~`_nodePrototypeClearEventListener`~~
  - [ ] `initialize`
  - [x] `width`
  - [x] `height`
  - [x] `backgroundColor`
  - [x] `debugColor`
  - [x] `opacity`
  - [x] `visible`
  - [x] `touchEnabled`
  - [x] `intersect`
  - [x] `_intersectOne`
  - [x] `_intersectStrict`
  - [x] `_intersectStrictOne`
  - [x] `within`
  - [x] `scale`
  - [x] `rotate`
  - [x] `scaleX`
  - [x] `scaleY`
  - [x] `rotation`
  - [x] `originX`
  - [x] `originY`
  - [ ] ~~`enableCollection`~~
  - [ ] ~~`disableCollection`~~
  - [ ] ~~`clearEventListener`~~
  - [ ] ~~`_addSelfToCollection`~~
  - [ ] ~~`_removeSelfFromCollection`~~
  - [x] `getBoundingRect`
  - [x] `getOrientedBoundingRect`
  - [ ] ~~`getConstructor`~~
  - [ ] ~~`_collectizeConstructor`~~
  - [ ] ~~`_inherited`~~
- [ ] `Sprite.js`
  - [x] `initialize`
  - [x] `image`
  - [x] `frame`
  - [x] `_frameSequence`
  - [x] `_deepCompareToPreviousFrame`
  - [x] `_computeFramePosition`
  - [x] `_rotateFrameSequence`
  - [x] `width`
  - [x] `height`
  - [x] `cvsRender`
  - [x] `domRender`
- [ ] `Label.js`
  - [ ] `initialize`
  - [ ] `width`
  - [ ] `text`
  - [ ] `textAlign`
  - [ ] `font`
  - [ ] `color`
  - [ ] `cvsRender`
  - [ ] `domRender`
  - [ ] `detectRender`
  - [ ] `updateBoundArea`
  - [ ] `getMetrics`
- [ ] `Map.js`
  - [ ] `initialize`
  - [ ] `loadData`
  - [ ] `checkTile`
  - [ ] `hitTest`
  - [ ] `image`
  - [ ] `tileWidth`
  - [ ] `tileHeight`
  - [ ] `width`
  - [ ] `height`
  - [ ] `redraw`
  - [ ] `updateBuffer`
  - [ ] `cvsRender`
  - [ ] `domRender`
- [x] `Group.js`
  - [x] `initialize`
  - [x] `addChild`
  - [x] `insertBefore`
  - [x] `removeChild`
  - [x] `firstChild`
  - [x] `lastChild`
  - [x] `rotation`
  - [x] `scaleX`
  - [x] `scaleY`
  - [x] `originX`
  - [x] `originY`
  - [x] `_dirty`
- [x] `Matrix.js`
- [ ] `DetectColorManager.js`
  - [ ] `initialize`
- [ ] `DomManager.js`
  - [ ] `DomManager`
    - [x] `initialize`
    - [x] `getDomElement`
    - [x] `getDomElementAsNext`
    - [x] `getNextManager`
    - [x] `addManager`
    - [x] `removeManager`
    - [x] `setLayer`
    - [x] `render`
    - [x] `domRender`
    - [x] `_attachEvent`
    - [x] `_detachEvent`
    - [x] `remove`
  - [ ] `DomlessManager`
    - [ ] `initialize`
    - [ ] `_register`
    - [ ] `getNextManager`
    - [ ] `getDomElement`
    - [ ] `getDomElementAsNext`
    - [ ] `addManager`
    - [ ] `removeManager`
    - [ ] `setLayer`
    - [ ] `render`
    - [ ] `remove`
- [ ] `DomLayer.js`
- [ ] `CanvasLayer.js`
  - [x] `initialize`
  - [ ] `addChild`
  - [ ] `insertBefore`
  - [ ] `_startRendering`
  - [ ] `_stopRendering`
  - [ ] `_onexitframe`
  - [ ] `_determineEventTarget`
  - [ ] `_getEnityByPosition`
  - [x] `_setImageSmoothingEnable`
  - [ ] `_attachCache`
  - [ ] `_detachCache`
- [ ] `CanvasRenderer.js`
- [ ] `Scene.js`
  - [x] `initialize`
  - [ ] `x`
  - [ ] `y`
  - [ ] `width`
  - [ ] `height`
  - [ ] `rotation`
  - [ ] `scaleX`
  - [ ] `scaleY`
  - [ ] `backgroundColor`
  - [x] `remove`
  - [x] `_oncoreresize`
  - [ ] `addLayer`
  - [ ] `_determineEventTarget`
  - [x] `_onchildadded`
  - [x] `_onchildremoved`
  - [x] `_onenter`
  - [x] `_onexit`
- [ ] `LoadingScene.js`
  - [ ] `initialize`
- [ ] `CanvasScene.js`
- [ ] `DOMScene.js`
- [ ] `Surface.js`
  - [ ] `initialize`
  - [ ] `getPixel`
  - [ ] `setPixel`
  - [ ] `clear`
  - [ ] `draw`
  - [ ] `clone`
  - [ ] `toDataURL`
  - [ ] `load`
  - [ ] `_getPattern`
- [ ] `Deferred.js`

__sound support__

- [x] `DOMSound.js`
- [x] `WebAudioSound.js`
- [x] `Sound.js`

__animation feature__

- [ ] `Easing.js`
- [ ] `ActionEventTarget.js`
  - [ ] `initalize`
  - [ ] `dispatchEvent`
- [ ] `Timeline.js`
  - [x] `initialize`
  - [x] `_deactivateTimeline`
  - [x] `_activateTimeline`
  - [x] `_onenterframe`
  - [x] `setFrameBased`
  - [x] `setTimeBased`
  - [ ] `next`
  - [ ] `tick`
  - [ ] `add`
  - [ ] `action`
  - [ ] `tween`
  - [ ] `clear`
  - [ ] `skip`
  - [ ] `pause`
  - [ ] `resume`
  - [ ] `loop`
  - [ ] `unloop`
  - [ ] `delay`
  - [ ] `wait`
  - [ ] `then`
  - [ ] `exec`
  - [ ] `cue`
  - [ ] `repeat`
  - [ ] `and`
  - [ ] `or`
  - [ ] `doAll`
  - [ ] `waitAll`
  - [ ] `waitUntil`
  - [ ] `fadeTo`
  - [ ] `fadeIn`
  - [ ] `fadeOut`
  - [ ] `moveTo`
  - [ ] `moveX`
  - [ ] `moveY`
  - [ ] `moveBy`
  - [ ] `hide`
  - [ ] `show`
  - [ ] `removeFromScene`
  - [ ] `scaleTo`
  - [ ] `scaleBy`
  - [ ] `rotateTo`
  - [ ] `rotateBy`
- [ ] `Action.js`
  - [ ] `initialize`
- [ ] `ParallelAction.js`
- [ ] `Tween.js`
